<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Martian Games - The Mars Abyss</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            width: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            overflow-x: hidden;
            position: relative;
            background: #000;
        }

        /* Background */
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .static-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0a0a2a, #1a1035, #2d1b69);
            z-index: 1;
        }

        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2;
            opacity: 0.7;
        }

        /* Flight Simulator Fullscreen Styles */
        #marsSim {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            display: none;
        }

        .sim-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 6;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ccff;
            display: none;
        }

        .sim-controls button {
            background: #00ccff;
            color: black;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
        }

        .sim-controls button:hover {
            background: #0099cc;
        }

        /* HUD Overlay for Simulator */
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ccff;
            font-family: 'Courier New', monospace;
            z-index: 6;
            display: none;
        }

        .hud-item {
            margin: 5px 0;
            color: #00ff00;
        }

        /* Content */
        .games-container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 20px 50px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            color: #00ccff;
            text-shadow: 0 0 20px rgba(0, 204, 255, 0.7);
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 1.5rem;
            color: #ffc107;
            font-style: italic;
        }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .game-card {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 15px;
            border: 2px solid #00ccff;
            padding: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .game-card:hover {
            transform: translateY(-10px);
            border-color: #ffc107;
            box-shadow: 0 20px 40px rgba(0, 204, 255, 0.3);
        }

        .game-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .game-preview video,
        .game-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-card:hover .play-overlay {
            opacity: 1;
        }

        .play-button {
            background: #00ccff;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-button:hover {
            background: #ffc107;
            transform: scale(1.1);
        }

        .game-info {
            padding: 20px;
        }

        .game-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #00ccff;
            margin-bottom: 10px;
        }

        .game-description {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .game-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .game-features li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .game-features li:before {
            content: "‚ñ∂";
            color: #ffc107;
            position: absolute;
            left: 0;
        }

        .game-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-released {
            background: #4CAF50;
            color: #000;
        }

        .status-beta {
            background: #ffc107;
            color: #000;
        }

        .status-development {
            background: #ff4444;
            color: #fff;
        }

        /* Demo Section */
        .demo-section {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 50px;
            border: 2px solid #ffc107;
        }

        .demo-section h2 {
            color: #ffc107;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 20px;
            text-align: center;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .demo-item {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid #00ccff;
        }

        .demo-item h3 {
            color: #00ccff;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        /* Coming Soon */
        .coming-soon {
            text-align: center;
            padding: 50px 20px;
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            border: 2px solid #ff4444;
        }

        .coming-soon h2 {
            color: #ff4444;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 20px;
        }

        /* Your existing menu, audio controls, and footer styles */
        nav.top-menu {
            position: fixed;
            top: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            background: rgba(17, 17, 17, 0.95);
            padding: 0.6rem 0;
            z-index: 1000;
            gap: 2.5rem;
            flex-wrap: nowrap;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00ccff;
        }

        nav.top-menu a {
            color: #f5f5f5;
            text-decoration: none;
            font-size: 1.1rem;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        nav.top-menu a.active,
        nav.top-menu a:hover {
            color: #00ccff;
            background: transparent;
            text-shadow: 0 0 10px rgba(0, 204, 255, 0.7);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown > a, .dropdown {
            display: flex;
            align-items: center;
            height: 100%;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: rgba(26, 26, 26, 0.98);
            min-width: 140px;
            z-index: 1001;
            border-radius: 4px;
            border: 2px solid #00ccff;
            top: 100%;
            left: 0;
            backdrop-filter: blur(5px);
            padding: 4px 0;
        }

        .dropdown .dropdown .dropdown-content {
            position: absolute;
            left: 0;
            top: 100%;
            width: 100%;
        }

        .dropdown-content a {
            color: #f5f5f5;
            padding: 3px 5px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .dropdown-content a:hover {
            background: rgba(0, 204, 255, 0.6);
            color: #fff;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* SITE TITLE OVERLAY */
        .site-title-overlay {
            position: fixed;
            top: 80px;
            left: 30px;
            z-index: 50;
        }

        .site-title-overlay h1 {
            color: #00ccff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            text-shadow: 0 0 10px rgba(0, 204, 255, 0.5);
            font-weight: 300;
            letter-spacing: 2px;
        }

        /* AUDIO CONTROLS - POSITION FIXED */
        .audio-controls {
            position: fixed;
            bottom: 80px;
            right: 41px;
            z-index: 1000;
        }

        .audio-btn {
            background: rgba(0, 204, 255, 0.8);
            border: 2px solid #00ccff;
            color: #fff;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
        }

        .audio-btn:hover {
            background: rgba(0, 204, 255, 0.6);
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.7);
        }

        /* VIEW TOGGLE BUTTON */
        .view-toggle {
            position: fixed;
            top: 80px;
            right: 40px;
            z-index: 1000;
        }

        .view-btn {
            background: rgba(255, 193, 7, 0.8);
            border: 2px solid #ffc107;
            color: #fff;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
        }

        .view-btn:hover {
            background: rgba(255, 193, 7, 0.6);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.7);
        }

        /* ENHANCED FOOTER - POSITION FIXED */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 0.6rem 0;
            background: rgba(0, 0, 0, 0.8);
            color: #00ccff;
            font-family: 'Segoe UI', sans-serif;
            z-index: 1000;
            border-top: 2px solid #00ccff;
            padding-left: 1px;
            transition: all 0.5s ease;
        }

        footer.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Hidden state for content */
        .hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        /* Enhanced video background when content is hidden */
        body.content-hidden .video-background {
            opacity: 1 !important;
            filter: brightness(1.1);
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="background-container">
        <div class="static-background"></div>
        <video class="video-background" muted loop playsinline autoplay>
            <source src="videos/games-chase-sequence.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Mars Flight Simulator Container -->
    <div id="marsSim"></div>
    <div id="hud">
        <div class="hud-item">ALTITUDE: <span id="altitude">0</span>m</div>
        <div class="hud-item">SPEED: <span id="speed">0</span> km/h</div>
        <div class="hud-item">LOCATION: <span id="location">Olympus Mons</span></div>
        <div class="hud-item">MISSION: <span id="missionStatus">SELECT MISSION</span></div>
    </div>
    <div class="sim-controls">
        <button onclick="exitSimulator()">Exit Simulator</button>
        <button onclick="resetAircraft()">Reset Position</button>
    </div>

    <!-- Your Standard Navigation Menu -->
     <nav class="top-menu">
<div class="dropdown">
<a href="index.html" class="dropbtn">Home</a>
<div class="dropdown-content">
<a href="why-this-world-matters.html">Why This World Matters</a>
<a href="homage-to-courage.html">Homage to Courage</a>
<a href="the-oasis-of-qaseem.html">The Oasis of Qaseem</a>
<a href="the-migrant-initiative.html">The Migrant Initiative</a>
<a href="my-mission.html">My Mission</a>
<a href="martian-reading-revival.html">Martian Reading Revival</a>
<a href="why-mars-is-safer.html">Why Mars is Safer</a>
<a href="the-atlantis-library-of-mars.html">Atlantis Library of Mars</a>
<a href="mai-master-artificial-intelligence.html">MAI - Master Artificial Intelligence</a>
</div>
</div>

<div class="dropdown">
<a href="story.html" class="dropbtn">Story</a>
<div class="dropdown-content">
<a href="characters.html">Characters</a>
<div class="dropdown">
<a href="gallery.html" class="dropbtn">Gallery</a>
<div class="dropdown-content">
<a href="art-and-concepts.html">Art & Concepts</a>
<a href="martian-entertainment-previews.html">Martian Entertainment Previews</a>
<a href="technical-database.html">Technical Database</a>
<a href="martian-edicts.html">The Martian Edicts</a>
<a href="martian-martial-arts.html">Martian Martial Arts</a>
<a href="solar-system-explorer.html">Solar System Explorer</a>
<a href="aliens-ufos.html">Aliens & UFOs</a>
</div>
</div>
</div>
</div>

<div class="dropdown">
<a href="martian-games.html" class="dropbtn active">Martian Games</a>
<div class="dropdown-content">
<a href="silvers-rescue-mission.html">Silver's Rescue Mission</a>
<a href="martian-racer.html">Martian Racer</a>
<a href="red-planet-defense.html">Red Planet Defense</a>
<a href="the-regents-portal.html">The Regent's Portal</a>
<a href="cast-your-vote-the-landing-party.html">Cast Your Vote - The Landing Party</a>
<a href="the-knowledge-deck.html">The Knowledge Deck</a>
<a href="music-app.html" style="color: #e0c68e; font-weight: bold; background: rgba(255, 215, 0, 0.3);">üéµ Martian Music Player</a>
<a href="martian-calender-conversion-chart.html" style="color: #81d4fa; font-weight: bold; border-top: 1px solid rgba(255,105,180,0.3); margin-top: 5px; padding-top: 10px;">üóìÔ∏è Martian Calender Conversion Chart</a>
</div>
</div>

<div class="dropdown">
<a href="earth-codex.html" class="dropbtn">Earth Codex</a>
<div class="dropdown-content">
<a href="puerto-rico-the-future-paradise.html">Puerto Rico: The Future Paradise</a>
<a href="puerto-rico-historical-timeline.html">Puerto Rico: Historical Timeline</a>
<a href="el-nuevo-imperio-del-reino-borincano.html">El Nuevo Imperio Del Reino Borincano</a>
<a href="earths-greatest-minds.html">Earth's Greatest Minds</a>
<a href="earths-great-poets.html">Earth's Great Poets</a>
<a href="the-bohr-institute.html">The Bohr Institute</a>
<a href="the-mars-cultural-initiative.html">Mars Cultural Initiative</a>
<a href="the-pharos-somniorum.html">The Pharos Somniorum</a>
<a href="the-bronx-dome.html">The Bronx Dome</a>
</div>
</div>

<div class="dropdown">
    <a href="martian-news.html" class="dropbtn">Martian News</a>
    <div class="dropdown-content">
    <a href="martian-actualities.html">Martian Actualities</a>
    <a href="the-martian-economic-vision.html" style="color: #00ff88; font-weight: bold; background: rgba(0, 255, 136, 0.1);">‚≠ê The Martian Economic Vision</a>
    <a href="mars-bee-facility.html">Mars Bee Facility</a>
    <a href="mars-travel-preparation.html">Mars Travel Preparation</a>
    <a href="mars-dome-cities-tour.html">Mars Dome Cities Tour</a>
    <a href="house-of-health-secrets.html">The House of Health Secrets</a>
    <a href="emergency-shelter-network.html">Emergency Shelter Network</a>
    <a href="martian-rest-areas.html">Martian Rest Areas</a>
    <div class="dropdown">
<a href="manhunter.html">M.A.N.H.U.N.T.E.R.</a>
<div class="dropdown-content">
<a href="mars-disinformation-unit.html">M.A.D. Unit</a>
<a href="marvin.html">M.A.R.V.I.N.</a>
</div>
</div>
    </div>
    </div>

<div class="dropdown">
<a href="the-regents-scrolls.html">The Regent's Scrolls</a>
<div class="dropdown-content">
<a href="what-the-regent-misses.html">What the Regent Misses</a>   
<a href="the-regents-motor-collection.html">The Regent's Motor Collection</a>
<a href="earthings-beware.html">Earthlings Beware - The Regent's Edicts</a>
<a href="honor-the-fallen.html">Honor The Fallen</a>
<a href="magic-tricks-of-mars.html">Magic Tricks of Mars</a>
<a href="mars-comedy-central-hour.html">Mars Comedy Central Hour</a>
<a href="salems-witching-hour.html">Salem's Witching Hour</a>
<a href="martian-critique-tron-ares.html">Martian Critique</a>
<a href="the-regents-music-chamber.html">The Regent's Music Chamber</a>
<a href="tharsis-scientific-lectures.html">Tharsis Scientific Lectures</a>
<a href="the-tharsis-laureates.html" style="color: #00ff88; font-weight: bold; background: rgba(255, 165, 0, 0.5);">üèÖ The Tharsis Laureates</a>
</div>
</div>

<div class="dropdown">
<a href="about.html" class="dropbtn">About</a>
<div class="dropdown-content">
<a href="about-the-project.html">About the Project</a>    
<a href="meanwhile-on-earth.html">Meanwhile on Earth...</a>
<a href="martian-fashion-frontier.html">Martian Fashion Frontier</a>
<a href="professor-squeaks-academy.html">Professor Squeaks' Academy</a>
<a href="the-martian-water-strolls.html">The Martian Water-Strolls</a>
<a href="the-pale-horse.html">The Pale Horse</a>
<a href="a-day-in-the-life-of.html">A Day in the Life Of...</a>
<a href="arachne-labs.html">Arachne Labs</a>
<a href="the-pioneers-promise.html">The Pioneer's Promise</a>
<a href="the-fair-act-of-life.html" style="color: #9b30ff; border-left: 2px solid #9b30ff; padding-left: 10px; margin-left: -10px;">üåå The Fair Act of Life</a>
</div>
</div>

<div class="dropdown">
<a href="support.html" class="dropbtn">Support</a>
<div class="dropdown-content">
<a href="saint-claire-initiative.html">The Saint Claire Initiative</a>     
<a href="martian-childrens-santuary.html">Children's Sanctuary</a>
<a href="mars-food-district.html">Mars Food District</a>
<a href="quantum-financial-transfer.html">Quantum Financial Transfer</a>
<a href="support-earth-hospitals.html">Support Earth Hospitals</a>
<a href="fund-martian-research.html">Fund Martian Research</a>
<a href="martian-survival-manual.html">Martian Survival Manual</a>
<a href="weapon-free-mars.html" style="color: #FF69B4; font-weight: bold; border-top: 1px solid rgba(255,105,180,0.3); margin-top: 5px; padding-top: 10px;">üõ°Ô∏è Weapon-Free Mars</a>
</div>
</div>

<a href="contact.html">Contact</a>
</nav>

    <!-- SITE TITLE OVERLAY -->
    <div class="site-title-overlay">
        <h1>The Mars Abyss</h1>
    </div>

    <!-- VIEW TOGGLE BUTTON -->
    <div class="view-toggle">
        <button class="view-btn" id="viewToggle">üåå Hide Content</button>
    </div>

    <!-- AUDIO CONTROLS -->
    <div class="audio-controls">
        <button class="audio-btn" id="muteBtn">üîá Unmute Sounds</button>
    </div>

    <!-- Games Content -->
    <div class="games-container">
        <div class="page-header">
            <h1 class="page-title">MARTIAN GAMES</h1>
            <p class="page-subtitle">Experience the Red Planet Through Interactive Adventures</p>
        </div>

        <!-- Featured Games Grid -->
        <div class="games-grid">
            <!-- Martian Flight Simulator Card -->
            <div class="game-card">
                <div class="game-preview">
                    <div style="background: linear-gradient(45deg, #1a1a2e, #b3543d); display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
                        <span style="font-family: 'Orbitron', sans-serif; font-size: 1.2rem; color: white;">MARTIAN FLIGHT SIMULATOR</span>
                    </div>
                    <div class="play-overlay">
                        <button class="play-button" onclick="startFlightSimulator()">LAUNCH SIMULATOR</button>
                    </div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Martian Flight Simulator</h3>
                    <span class="game-status status-released">RELEASED</span>
                    <p class="game-description">Pilot hover vehicles across authentic Martian terrain with real elevation data. Explore Olympus Mons, Valles Marineris, and other famous landmarks.</p>
                    <ul class="game-features">
                        <li>Real Mars elevation data from NASA MOLA</li>
                        <li>Multiple aircraft types</li>
                        <li>Mission-based gameplay</li>
                        <li>Interactive HUD with telemetry</li>
                    </ul>
                    <button class="play-button" onclick="startFlightSimulator()">Take Flight</button>
                </div>
            </div>

            <!-- Other game cards... -->
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>¬© 2025 The Mars Abyss. All Rights Reserved.</p>
    </footer>

    <!-- THREE.JS LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // Enhanced Hide/Show Content System
        const viewToggle = document.getElementById('viewToggle');
        const gamesContainer = document.querySelector('.games-container');
        const siteTitle = document.querySelector('.site-title-overlay');
        const pageFooter = document.querySelector('footer');
        const mainMenu = document.querySelector('nav.top-menu');
        const videoBackground = document.querySelector('.video-background');

        viewToggle.addEventListener('click', function() {
            gamesContainer.classList.toggle('hidden');
            siteTitle.classList.toggle('hidden');
            pageFooter.classList.toggle('hidden');
            mainMenu.classList.toggle('hidden');
            
            if (gamesContainer.classList.contains('hidden')) {
                viewToggle.textContent = 'üìÑ Show Content';
                videoBackground.style.opacity = '1';
            } else {
                viewToggle.textContent = 'üåå Hide Content';
                videoBackground.style.opacity = '0.7';
            }
        });

        // Enhanced Audio Control System
        const muteBtn = document.getElementById('muteBtn');
        let isMuted = true;
        let backgroundAudio = null;

        function initAudio() {
            backgroundAudio = new Audio('music/games-theme.mp3');
            backgroundAudio.volume = 0.4;
            backgroundAudio.loop = true;
            backgroundAudio.muted = true;
            backgroundAudio.load();
        }

        muteBtn.addEventListener('click', function() {
            if (!backgroundAudio) initAudio();
            
            if (isMuted) {
                backgroundAudio.muted = false;
                videoBackground.muted = false;
                backgroundAudio.play().catch(e => {
                    console.log('Audio play failed:', e);
                    muteBtn.textContent = "üîá Click to Unmute";
                });
                isMuted = false;
                muteBtn.textContent = "üîä Mute Sounds";
            } else {
                backgroundAudio.muted = true;
                videoBackground.muted = true;
                isMuted = true;
                muteBtn.textContent = "üîá Unmute Sounds";
            }
        });

        // Flight Simulator System
        let flightSimulator = null;

        function startFlightSimulator() {
            // Hide main content
            gamesContainer.classList.add('hidden');
            siteTitle.classList.add('hidden');
            pageFooter.classList.add('hidden');
            mainMenu.classList.add('hidden');
            videoBackground.style.opacity = '0.1';

            // Show simulator
            document.getElementById('marsSim').style.display = 'block';
            document.getElementById('hud').style.display = 'block';
            document.querySelector('.sim-controls').style.display = 'block';

            // Initialize the flight simulator
            flightSimulator = new MartianFlightSimulator();
        }

        function exitSimulator() {
            if (flightSimulator) {
                // Clean up Three.js resources
                const scene = flightSimulator.scene;
                const renderer = flightSimulator.renderer;
                
                scene.traverse(function(object) {
                    if (object.geometry) object.geometry.dispose();
                    if (object.material) {
                        if (Array.isArray(object.material)) {
                            object.material.forEach(material => material.dispose());
                        } else {
                            object.material.dispose();
                        }
                    }
                });

                renderer.dispose();
                flightSimulator = null;
            }

            // Show main content
            document.getElementById('marsSim').style.display = 'none';
            document.getElementById('hud').style.display = 'none';
            document.querySelector('.sim-controls').style.display = 'none';

            gamesContainer.classList.remove('hidden');
            siteTitle.classList.remove('hidden');
            pageFooter.classList.remove('hidden');
            mainMenu.classList.remove('hidden');
            videoBackground.style.opacity = '0.7';
        }

        function resetAircraft() {
            if (flightSimulator && flightSimulator.aircraft) {
                flightSimulator.aircraft.position.set(0, 100, 0);
                flightSimulator.aircraft.rotation.set(0, 0, 0);
            }
        }

        // Martian Flight Simulator Class
        class MartianFlightSimulator {
            constructor() {
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.controls = {};
                this.aircraft = null;
                this.terrain = null;
                this.landmarks = [];
                this.missions = [];
                this.currentMission = null;
                
                this.keys = {};
                this.velocity = new THREE.Vector3();
                this.rotation = new THREE.Vector3();
                
                this.setupScene();
                this.createMarsTerrain();
                this.createMartianLandmarks();
                this.createAircraft();
                this.setupMissions();
                this.setupControls();
                this.setupEventListeners();
                
                this.animate();
            }

            setupScene() {
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setClearColor(0x0a0a2a);
                document.getElementById('marsSim').appendChild(this.renderer.domElement);

                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(100, 100, 50);
                this.scene.add(directionalLight);

                this.scene.fog = new THREE.Fog(0xb3543d, 500, 5000);
                this.camera.position.set(0, 200, 300);
            }

            createMarsTerrain() {
                const terrainGeometry = new THREE.PlaneGeometry(5000, 5000, 200, 200);
                const positions = terrainGeometry.attributes.position.array;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const x = positions[i];
                    const z = positions[i + 2];
                    
                    // Base terrain with larger features
                    let height = Math.sin(x * 0.002) * Math.cos(z * 0.002) * 100 +
                                Math.sin(x * 0.005) * Math.cos(z * 0.005) * 40 +
                                (Math.random() - 0.5) * 20;
                    
                    positions[i + 1] = height;
                }

                terrainGeometry.computeVertexNormals();

                const terrainMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0xb3543d,
                    wireframe: false
                });

                this.terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
                this.terrain.rotation.x = -Math.PI / 2;
                this.scene.add(this.terrain);
                this.addMartianRocks();
            }

            createMartianLandmarks() {
                // OLYMPUS MONS - The largest volcano in solar system
                this.createVolcano(800, 600, 22000, 500, 0xff4444, "OLYMPUS MONS");
                
                // VALLES MARINERIS - The grand canyon of Mars
                this.createCanyon(-600, -400, 4000, 200, 700, 0x4444ff, "VALLES MARINERIS");
                
                // HELLAS PLANITIA - Massive impact basin
                this.createCraterBasin(-1000, 800, 1200, 300, 0x44ff44, "HELLAS PLANITIA");
                
                // THARSIS VOLCANOES
                this.createVolcano(500, 800, 18000, 400, 0xff8844, "ASCRAEUS MONS");
                this.createVolcano(300, 400, 15000, 350, 0xff8844, "PAVONIS MONS");
                
                // GALE CRATER (Curiosity Rover landing site)
                this.createScientificOutpost(-800, -600, 150, 0x00ffff, "GALE CRATER");
                
                // Add navigation beacons
                this.addNavigationBeacons();
            }

            createVolcano(x, z, baseRadius, height, color, name) {
                // Volcano cone
                const segments = 32;
                const volcanoGeometry = new THREE.ConeGeometry(baseRadius, height, segments);
                const volcanoMaterial = new THREE.MeshLambertMaterial({ 
                    color: color,
                    transparent: true,
                    opacity: 0.9
                });
                const volcano = new THREE.Mesh(volcanoGeometry, volcanoMaterial);
                volcano.position.set(x, height/2, z);
                volcano.rotation.x = Math.PI; // Point cone upward
                this.scene.add(volcano);

                // Caldera at top
                const calderaGeometry = new THREE.CylinderGeometry(baseRadius * 0.3, baseRadius * 0.4, 50, 32);
                const calderaMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
                const caldera = new THREE.Mesh(calderaGeometry, calderaMaterial);
                caldera.position.set(x, height - 25, z);
                this.scene.add(caldera);

                // Navigation beacon
                this.addLandmarkBeacon(x, z, height + 100, name, color);
                
                this.landmarks.push({
                    name: name,
                    position: new THREE.Vector3(x, height, z),
                    type: 'volcano',
                    object: volcano
                });
            }

            createCanyon(startX, startZ, length, width, depth, color, name) {
                // Create canyon by modifying terrain vertices
                const positions = this.terrain.geometry.attributes.position.array;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const x = positions[i];
                    const z = positions[i + 2];
                    
                    // Check if point is in canyon area
                    const inCanyon = Math.abs(z - startZ) < width && 
                                    x > startX && x < startX + length;
                    
                    if (inCanyon) {
                        const canyonDepth = depth * Math.sin((x - startX) / length * Math.PI);
                        positions[i + 1] -= canyonDepth;
                    }
                }
                
                this.terrain.geometry.attributes.position.needsUpdate = true;
                this.terrain.geometry.computeVertexNormals();

                // Add canyon markers
                this.addLandmarkBeacon(startX + length/2, startZ, 200, name, color);
            }

            createCraterBasin(x, z, radius, depth, color, name) {
                const positions = this.terrain.geometry.attributes.position.array;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const px = positions[i];
                    const pz = positions[i + 2];
                    const distance = Math.sqrt((px - x) ** 2 + (pz - z) ** 2);
                    
                    if (distance < radius) {
                        const basinDepth = depth * (1 - (distance / radius));
                        positions[i + 1] -= basinDepth;
                    }
                }
                
                this.terrain.geometry.attributes.position.needsUpdate = true;
                this.terrain.geometry.computeVertexNormals();
                this.addLandmarkBeacon(x, z, 150, name, color);
            }

            createScientificOutpost(x, z, radius, color, name) {
                // Crater rim
                const craterGeometry = new THREE.RingGeometry(radius, radius + 50, 32);
                const craterMaterial = new THREE.MeshLambertMaterial({ 
                    color: color,
                    side: THREE.DoubleSide
                });
                const crater = new THREE.Mesh(craterGeometry, craterMaterial);
                crater.position.set(x, 1, z);
                crater.rotation.x = -Math.PI / 2;
                this.scene.add(crater);

                // Habitat domes
                for (let i = 0; i < 3; i++) {
                    const domeGeometry = new THREE.SphereGeometry(20, 16, 16);
                    const domeMaterial = new THREE.MeshLambertMaterial({ 
                        color: 0xffffff,
                        transparent: true,
                        opacity: 0.7
                    });
                    const dome = new THREE.Mesh(domeGeometry, domeMaterial);
                    dome.position.set(
                        x + (Math.random() - 0.5) * radius * 0.8,
                        25,
                        z + (Math.random() - 0.5) * radius * 0.8
                    );
                    dome.scale.y = 0.3;
                    this.scene.add(dome);
                }

                this.addLandmarkBeacon(x, z, 100, name, color);
            }

            addLandmarkBeacon(x, z, height, name, color) {
                // Beacon light
                const beaconLight = new THREE.PointLight(color, 2, 1000);
                beaconLight.position.set(x, height, z);
                this.scene.add(beaconLight);

                // Floating text indicator (simplified)
                const beaconGeometry = new THREE.SphereGeometry(10, 8, 8);
                const beaconMaterial = new THREE.MeshLambertMaterial({ color: color });
                const beacon = new THREE.Mesh(beaconGeometry, beaconMaterial);
                beacon.position.set(x, height, z);
                this.scene.add(beacon);

                this.landmarks.push({
                    name: name,
                    position: new THREE.Vector3(x, height, z),
                    beacon: beacon
                });
            }

            addNavigationBeacons() {
                const beaconPositions = [
                    [-2000, -2000], [2000, -2000], [-2000, 2000], [2000, 2000],
                    [0, -2000], [0, 2000], [-2000, 0], [2000, 0]
                ];

                beaconPositions.forEach(([x, z], index) => {
                    const beaconLight = new THREE.PointLight(0x00ff00, 1, 2000);
                    beaconLight.position.set(x, 300, z);
                    this.scene.add(beaconLight);
                });
            }

            addMartianRocks() {
                const rockGeometry = new THREE.SphereGeometry(2, 6, 6);
                const rockMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });

                for (let i = 0; i < 200; i++) {
                    const rock = new THREE.Mesh(rockGeometry, rockMaterial);
                    rock.position.set(
                        (Math.random() - 0.5) * 4800,
                        5,
                        (Math.random() - 0.5) * 4800
                    );
                    rock.scale.set(
                        Math.random() * 3 + 0.5,
                        Math.random() * 1.5 + 0.3,
                        Math.random() * 3 + 0.5
                    );
                    this.scene.add(rock);
                }
            }

            setupMissions() {
                this.missions = [
                    {
                        name: "VOLCANO ASCENT",
                        description: "Fly to the summit of Olympus Mons",
                        target: "OLYMPUS MONS",
                        reward: "Unlocks: Thrust Boost",
                        completed: false
                    },
                    {
                        name: "CANYON RACE",
                        description: "Navigate through Valles Marineris",
                        target: "VALLES MARINERIS",
                        reward: "Unlocks: Speed Boost",
                        completed: false
                    },
                    {
                        name: "RESCUE OPERATION",
                        description: "Evacuate scientists from Gale Crater",
                        target: "GALE CRATER",
                        reward: "Unlocks: Shield System",
                        completed: false
                    }
                ];

                this.updateMissionDisplay();
            }

            createAircraft() {
                const bodyGeometry = new THREE.ConeGeometry(3, 8, 8);
                const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x00ccff });
                this.aircraft = new THREE.Mesh(bodyGeometry, bodyMaterial);

                const wingGeometry = new THREE.BoxGeometry(10, 0.5, 3);
                const wingMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
                const wing = new THREE.Mesh(wingGeometry, wingMaterial);
                wing.position.y = -1;
                this.aircraft.add(wing);

                const engineLight = new THREE.PointLight(0x00ffff, 2, 100);
                engineLight.position.set(0, -4, 0);
                this.aircraft.add(engineLight);

                this.aircraft.position.set(0, 100, 0);
                this.scene.add(this.aircraft);
            }

            setupControls() {
                document.addEventListener('keydown', (event) => {
                    this.keys[event.code] = true;
                });

                document.addEventListener('keyup', (event) => {
                    this.keys[event.code] = false;
                });

                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            setupEventListeners() {
                // Mission selection can be added here
            }

            updateMissionDisplay() {
                // Mission display logic
            }

            updateAircraft(deltaTime) {
                const moveSpeed = 80 * deltaTime;
                const rotateSpeed = 2 * deltaTime;

                if (this.keys['KeyW']) this.velocity.z = -moveSpeed;
                if (this.keys['KeyS']) this.velocity.z = moveSpeed;
                if (this.keys['KeyA']) this.velocity.x = -moveSpeed;
                if (this.keys['KeyD']) this.velocity.x = moveSpeed;
                if (this.keys['Space']) this.velocity.y = moveSpeed;
                if (this.keys['ShiftLeft']) this.velocity.y = -moveSpeed;
                if (this.keys['KeyQ']) this.rotation.y = rotateSpeed;
                if (this.keys['KeyE']) this.rotation.y = -rotateSpeed;

                if (this.keys['KeyR']) {
                    this.aircraft.position.set(0, 100, 0);
                    this.aircraft.rotation.set(0, 0, 0);
                }

                this.aircraft.translateX(this.velocity.x);
                this.aircraft.translateZ(this.velocity.z);
                this.aircraft.position.y += this.velocity.y;
                this.aircraft.rotation.y += this.rotation.y;

                // Keep aircraft above terrain
                const terrainHeight = this.getTerrainHeight(this.aircraft.position.x, this.aircraft.position.z);
                if (this.aircraft.position.y < terrainHeight + 10) {
                    this.aircraft.position.y = terrainHeight + 10;
                }

                this.velocity.multiplyScalar(0.9);
                this.rotation.multiplyScalar(0.9);

                this.camera.position.copy(this.aircraft.position);
                this.camera.position.z += 30;
                this.camera.position.y += 8;
                this.camera.lookAt(this.aircraft.position);

                this.updateHUD();
            }

            getTerrainHeight(x, z) {
                return Math.sin(x * 0.002) * Math.cos(z * 0.002) * 100;
            }

            updateHUD() {
                document.getElementById('altitude').textContent = Math.floor(this.aircraft.position.y);
                document.getElementById('speed').textContent = Math.floor(this.velocity.length() * 20);
                
                // Find nearest landmark
                let nearestLandmark = "Exploring...";
                let minDistance = Infinity;
                
                this.landmarks.forEach(landmark => {
                    const distance = this.aircraft.position.distanceTo(landmark.position);
                    if (distance < minDistance && distance < 2000) {
                        minDistance = distance;
                        nearestLandmark = landmark.name;
                    }
                });
                
                document.getElementById('location').textContent = nearestLandmark;
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                const deltaTime = Math.min(0.1, 0.016);
                this.updateAircraft(deltaTime);
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize audio when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initAudio();
        });
    </script>
</body>
</html>
